tools:
  search_capabilities: >
    Search available capabilities by intent.

    Use this first. It returns compact hits across workflows, runtime helpers,
    and execution patterns.

    Parameters:
    - query (required): intent, task, or keyword search text
    - limit (optional): max hits to return (default 8)

    Output format:
    - Markdown text (human-readable capability cards).

  read_capability: >
    Read the full capability document for one capability id.

    Use this immediately after `search_capabilities` to confirm argument schema,
    constraints, examples, and expected output shape before execution.

    Parameters:
    - capability_id (required): capability id from `search_capabilities`

    Output format:
    - Markdown text with JSON code fences for schema/examples/output shape.

  run_workflow: >
    Execute a prebuilt workflow by id with structured args.

    Prefer this path over generated scripts whenever a matching workflow exists.

    Parameters:
    - workflow_id (required): workflow id
    - args (required): JSON object of workflow arguments
    - timeout_seconds (optional): execution timeout (default 30, capped server-side)

    Output:
    - Markdown text with workflow-specific rendering (not raw JSON dumps).
    - Includes both `Process status` and `Output status` so execution vs parse/render issues are explicit.
    - Search-style workflows render concise match lists with line numbers.
    - File-context workflow renders a code block with line numbers.

  execute_ephemeral_script: >
    Execute a generated Python script in an isolated subprocess after AST safety checks.

    Use only when no prebuilt workflow can satisfy the task.

    Required script constraints:
    - must define `def parse_args(...)`
    - must define `async def main()`
    - must include `if __name__ == "__main__": ...`
    - imports are restricted; generated scripts should use `runtime.zoekt_tools`

    Parameters:
    - code (required): Python source code
    - args (optional): JSON object passed to script
    - timeout_seconds (optional): execution timeout

    Output format:
    - Markdown text with execution status and fenced sections for result_json/stdout/stderr.

guides:
  capability_first_flow: >
    Capability-first workflow:
    1. Call `search_capabilities` with the objective.
    2. Call `read_capability` on the best candidate id(s).
    3. Prefer `run_workflow` whenever a prebuilt workflow matches.
    4. Use `execute_ephemeral_script` only as fallback.

    Execution marker convention:
    - Scripts should print one final line in form `__RESULT_JSON__=<json>`.
    - The runner parses that payload into `ExecutionResult.result_json`.
