tools:
  list_capabilities: >
    List all available capabilities.

    Use this first. It returns compact hits across workflows, runtime helpers,
    and execution patterns.

    Parameters:
    - none

    Output format:
    - Markdown text (human-readable capability cards).

  read_capability: >
    Read the full capability document for one capability id.

    Use this immediately after `list_capabilities` to confirm argument schema,
    constraints, examples, and expected output shape before execution.

    Parameters:
    - capability_id (required): capability id from `list_capabilities`

    Output format:
    - Markdown text with JSON code fences for schema/examples/output shape.

  run_workflow_cli: >
    Execute a prebuilt workflow by CLI-style command.

    Prefer this path over generated scripts whenever a matching workflow exists.
    For code understanding tasks, prefer `symbol_definition`/`symbol_usage` first,
    then use `file_context_reader` only as a final, narrow follow-up.
    Hard limits: search context lines must be <= 2; file windows must be <= 60 lines.

    Parameters:
    - command (required): CLI form `<workflow_id> [--flag value]...`
    - timeout_seconds (optional): execution timeout (default 30, capped server-side)

    Output:
    - Markdown text with workflow-specific rendering (not raw JSON dumps).
    - Includes both `Process status` and `Output status` so execution vs parse/render issues are explicit.
    - Search-style workflows render concise match lists with line numbers.
    - File-context workflow renders a code block with line numbers.

  run_custom_workflow_code: >
    Execute generated custom workflow code in an isolated subprocess after AST safety checks.

    Use only when no prebuilt workflow can satisfy the task.

    Required script constraints:
    - preferred shape: `def run(args)` or `async def run(args)`
    - legacy shape with `parse_args/main/__main__` is still supported
    - imports are restricted; generated scripts should use
      `from runtime import zoekt_tools` or `import runtime.zoekt_tools as zoekt_tools`

    Parameters:
    - code (required): Python source code
    - args (optional): JSON object passed to script
    - timeout_seconds (optional): execution timeout

    Output format:
    - Markdown text with execution status and fenced sections for result_json/stdout/stderr.

guides:
  capability_first_flow: >
    Capability-first workflow:
    1. Call `list_capabilities`.
    2. Call `read_capability` on the best candidate id(s).
    3. Use `run_workflow_cli` for `symbol_definition`/`symbol_usage` to narrow scope.
    4. Use `file_context_reader` only after exact repo/path/line targets are known.
    5. Use `run_custom_workflow_code` only as fallback.

    Execution marker convention:
    - Runner accepts marker output `__RESULT_JSON__=<json>` and also falls back to parsing plain JSON stdout.
    - The runner parses that payload into `ExecutionResult.result_json`.
